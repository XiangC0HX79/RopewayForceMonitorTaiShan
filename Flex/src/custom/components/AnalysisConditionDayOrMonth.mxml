<?xml version="1.0" encoding="utf-8"?>
<components:SkinnableTitleContainer xmlns:fx="http://ns.adobe.com/mxml/2009" 
									xmlns:s="library://ns.adobe.com/flex/spark" 
									xmlns:mx="library://ns.adobe.com/flex/mx" xmlns:components="custom.components.*"
									skinClass="custom.skin.SkinPanelAnalysis"
									height="100%" width="200" title="统计时间">
	<fx:Metadata>
		[Event(name="TypeChange", type="flash.events.Event")]
	</fx:Metadata>
	
	<fx:Script>
		<![CDATA[
			import com.adobe.utils.DateUtil;
			
			import custom.skin.SkinPanelAnalysis;
			
			public static const TYPE_CHANGE:String = "TypeChange";
			
			public static const DAY:String = "Day";
			
			public static const MONTH:String = "Month";
			
			[Bindable]
			public function get type():String
			{
				return (comboTime.selectedIndex == 0)?DAY:MONTH;
			}

			public function set type(value:String):void
			{
				comboTime.selectedIndex = (value == DAY)?0:1;
			}
						
			[Bindable]
			public function get sTime():Date
			{		
				if(comboTime.selectedIndex == 0)
				{
					return dateDayS.selectedDate;
				}
				else if(comboTime.selectedIndex == 1)
				{
					return new Date(dateMonthS.selectedDate.fullYear,dateMonthS.selectedDate.month,1);
				}
				
				return new Date;
			}
			
			public function set sTime(value:Date):void
			{
				dateDayS.selectedDate = value;
				dateMonthS.selectedDate = value;
			}
			
			[Bindable]
			public function get eTime():Date
			{		
				if(comboTime.selectedIndex == 0)
				{
					return new Date(dateDayE.selectedDate.fullYear,dateDayE.selectedDate.month,dateDayE.selectedDate.date + 1);
				}
				else if(comboTime.selectedIndex == 1)
				{
					return new Date(dateMonthE.selectedDate.fullYear,dateMonthE.selectedDate.month + 1,1);
				}
				
				return new Date;
			}
			
			public function set eTime(value:Date):void
			{
				dateDayE.selectedDate = value;
				dateMonthE.selectedDate = value;				
			}
			
			private function parseMonth(valueString:String, inputFormat:String):Date 
			{
				var mask:String
				var temp:String;
				var monthString:String = "";
				var yearString:String = "";
				var j:int = 0;
				
				var n:int = inputFormat.length;
				for (var i:int = 0; i < n; i++,j++)
				{
					temp = "" + valueString.charAt(j);
					mask = "" + inputFormat.charAt(i);
					
					if (mask == "M")
					{
						if (isNaN(Number(temp)) || temp == " ")
							j--;
						else
						monthString += temp;
					}
					else if (mask == "Y")
					{
						yearString += temp;
					}
					else if (!isNaN(Number(temp)) && temp != " ")
					{
						return null;
					}
				}
				
				temp = "" + valueString.charAt(inputFormat.length - i + j);
				if (!(temp == "") && (temp != " "))
					return null;
				
				var monthNum:Number = Number(monthString);
				var yearNum:Number = Number(yearString);
				
				if (isNaN(yearNum) || isNaN(monthNum))
					return null;
				
				if (yearString.length == 2 && yearNum < 70)
					yearNum+=2000;
				
				var newDate:Date = new Date(yearNum, monthNum - 1, 1);
				
				if ((monthNum - 1) != newDate.getMonth())
					return null;
				
				return newDate;
			}
		]]>
	</fx:Script>
	<fx:Declarations>
		<!-- 将非可视元素（例如服务、值对象）放在此处 -->
	</fx:Declarations>
	
	<s:HGroup width="100%" verticalAlign="middle">
		<s:Label text="类　　型："/>
		<s:DropDownList id="comboTime" requireSelection="true" 
						change="dispatchEvent(new Event(TYPE_CHANGE))"
						width="100%" height="21">
			<s:ArrayCollection>
				<fx:String>按天</fx:String>
				<fx:String>按月</fx:String>
			</s:ArrayCollection>
		</s:DropDownList>				
	</s:HGroup>			
	
	<mx:ViewStack width="100%" height="100%" creationPolicy="all"
				  selectedIndex="{comboTime.selectedIndex}">				
		<s:NavigatorContent width="100%">
			<s:layout>
				<s:VerticalLayout/>
			</s:layout>
			<s:HGroup width="100%" verticalAlign="middle">
				<s:Label text="开始日期："/>
				<mx:DateField id="dateDayS" width="100%" formatString="YYYY-MM-DD" selectedDate="{new Date}" height="21"/>
			</s:HGroup>
			<s:HGroup width="100%" verticalAlign="middle">
				<s:Label text="结束日期："/>
				<mx:DateField id="dateDayE" width="100%" formatString="YYYY-MM-DD" selectedDate="{new Date}" height="21"/>
			</s:HGroup>
		</s:NavigatorContent>
		<s:NavigatorContent width="100%">
			<s:layout>
				<s:VerticalLayout/>
			</s:layout>
			<s:HGroup width="100%" verticalAlign="middle">
				<s:Label text="开始月份："/>
				<mx:DateField id="dateMonthS" width="100%" formatString="YYYY-MM" selectedDate="{DateUtil.addDateTime('d',-1,new Date)}" height="21" parseFunction="parseMonth"/>
			</s:HGroup>
			<s:HGroup width="100%" verticalAlign="middle">
				<s:Label text="结束月份："/>
				<mx:DateField id="dateMonthE" width="100%" formatString="YYYY-MM" selectedDate="{DateUtil.addDateTime('d',-1,new Date)}" height="21" parseFunction="parseMonth"/>
			</s:HGroup>
		</s:NavigatorContent>
	</mx:ViewStack>
</components:SkinnableTitleContainer>
